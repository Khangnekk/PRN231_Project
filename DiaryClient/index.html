<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Sign In & Registration Form</title>
  <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body>
  <div class="container">
    <input type="checkbox" id="check">
    <div class="Sign-In form">
      <header>Sign In</header>
      <form id="loginForm">
        <input type="text" id="loginUsername" placeholder="Enter your username">
        <input type="password" id="loginPassword" placeholder="Enter your password">
        <a href="#">Forgot password?</a>
        <input type="button" class="button" value="Sign In" onclick="login()">
      </form>
      <div class="signup">
        <span class="signup">Don't have an account?
         <label for="check">Signup</label>
        </span>
      </div>
      <span class="guest">
        <a href="views/newsfeed.html">
          Xem với tư cách Guest
        </a>
      </span>
    </div>
    <div class="registration form">
      <header>Signup</header>
      <form id="registerForm">
        <input type="text" id="registerUsername" placeholder="Enter your username">
        <input type="text" id="registerFullname" placeholder="Enter your fullname">
        <input type="password" id="registerPassword" placeholder="Create a password">
        <input type="password" id="confirmPassword" placeholder="Confirm your password">
        <input type="button" class="button" value="Signup" onclick="register()">
      </form>
      <div class="signup">
        <span class="signup">Already have an account?
         <label for="check">Sign In</label>
        </span>
      </div>
      <span class="guest">
        <a href="views/newsfeed.html">
          Xem với tư cách Guest
        </a>
      </span>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    function login() {
      var username = $("#loginUsername").val();
      var password = $("#loginPassword").val();

      $.ajax({
        url: "http://localhost:5109/api/Auth/login",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({ Username: username, Password: password }),
        success: function(response) {
          alert("Login successful!");
          localStorage.setItem("token", response.token); 
          window.location.href = "views/newsfeed.html"; 
        },
        error: function(xhr, status, error) {
          alert("Login failed: " + xhr.responseText);
        }
      });
    }

    function register() {
      var username = $("#registerUsername").val();
      var fullname = $("#registerFullname").val();
      var password = $("#registerPassword").val();
      var confirmPassword = $("#confirmPassword").val();

      if (password !== confirmPassword) {
        alert("Passwords do not match!");
        return;
      }

      $.ajax({
        url: "http://localhost:5109/api/Auth/register",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({Username: username, Fullname: fullname, Password: password }),
        success: function(response) {
          alert("Registration successful!");
          $(".Sign-In").css("display", "block");
          $(".registration").css("display", "none");
        },
        error: function(xhr, status, error) {
          alert("Registration failed: " + xhr.responseText);
        }
      });
    }
  </script>
</body>
</html>
